generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  STUDENT
  LECTURER
}

model User {
  id       Int     @id @default(autoincrement())
  name     String
  email    String  @unique
  password String
  role     Role
  phone    String?

  courses     Course[]     @relation("LecturerCourses")
  enrollments Enrollment[]
  submissions Submission[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Course {
  id          Int     @id @default(autoincrement())
  title       String
  description String?

  lecturerId Int
  lecturer   User @relation("LecturerCourses", fields: [lecturerId], references: [id])

  enrollments Enrollment[]
  assignments Assignment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Enrollment {
  id Int @id @default(autoincrement())

  studentId Int
  courseId  Int

  student User   @relation(fields: [studentId], references: [id])
  course  Course @relation(fields: [courseId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([studentId, courseId])
}

model Assignment {
  id          String @id @default(uuid())
  title       String
  description String

  courseId Int
  course   Course @relation(fields: [courseId], references: [id])

  submissions Submission[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Submission {
  id String @id @default(uuid())

  assignmentId String
  studentId    Int

  assignment Assignment @relation(fields: [assignmentId], references: [id])
  student    User       @relation(fields: [studentId], references: [id])

  content     String
  submittedAt DateTime @default(now())

  @@unique([assignmentId, studentId])
}
